---
title: "Establish a blaseRtemplates Installation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Establish a blaseRtemplates Installation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  eval = FALSE
)

```

## Introduction

The goals of blaseRtemplates are:

1.  To establish an encapsulated computing environment for data analysis in R.

2.  To improve upon existing methods for installing software packages and maintaining version control

3.  To provide useful template scripts for setting up projects, working with git, and doing other common, repetitive tasks.

The result, I hope, will be reduced system footprint (storage), faster package installation times, better reproducibility and an overall improved user experience.

## Establishing an Installation

Unfortunately, the terms we use for setting up programs, files and directories are overloaded. To distinguish the initial installation of the directory structure for blaseRtemplates from other uses of the verb "install", I use the term "establish". Sorry if that seems awkward.

First you must install the blaseRtemplates package using whatever package installer you currently use. Assuming the base install function, run:

```{r}
install.packages('blaseRtemplates', repos = c('https://blaserlab.r-universe.dev'))
```

What is r-universe? Basically it is CRAN without rules. In this case, it hosts blaseRtemplates linux source code and pre-compiled binaries for Windows and Mac.

Next, simply run the following command:

```{r}
library("blaseRtemplates")
establish_new_bt(cache_path = "<some_directory>/r_4_2_cache", project_path = "<some_directory>/projects")
```

What will this do?

-   It will create directories where indicated, write a standard .Rprofile document, and modify the user .Renviron file to configure R properly.\
-   It will not overwrite existing directories and will fail when an existing installation is already present in the same location.\
-   The only modification outside of the provided directory is to the .Renviron file. If you have existing configurations in your .Renviron file, they will only be changed if they are conflicting. If this is problematic, then you should archive your .Renviron file before running. The new .Renviron file will cause R to use the new .Rprofile in the cache directory and skip existing user- and project-level .Rprofiles.

Briefly, when R starts a new session, it looks for a series of files to configure itself. This configuration includes environment variables (in the .Renviron file) and any desired R code (in the .Rprofile file). As included in this function, these configurations only affect user experience i.e. they should not affect the results produced by your code. By user experience I mean connection to the proper package libraries and repositories and some safeguards to prevent working outside of projects.

For more information on how R starts, see [this link.](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Startup.html "R startup").

## Directory Structure



For the individual user: Identify the location for your blaseRtemplates cache and your R projects. For convenience, these can be within the same parent directory. The cache will hold versioned and hashed binary package files in the library directory. These are the actual instructions used by R when you call up functions. The version/hash structure is tracked by your projects and allows reproducibility. The user_project directory holds symlinks to the specific version/hash packages being used. A new directory is created for each new project. The source directory is used by the package installer, pak, to archive the source files for each package. You should rarely need to look in there. The logs directory holds .Rhistory files. One is created for each R session you open. The .tsv files catalog the entire collection of packages in your cache with their dependencies. The .Rprofile is what sets up your R session to use the proper user_package directory, ensures you are working in a valid project, generates startup messages and sets some helpful options.

This function will create 1 project, called baseproject, in the projects directory which will ensure you are always operating in a project environment. Working outside of a project can have dangerous/unintended consequences.

For the system administrator: the directory structure will work equally well for a multiuser system (e.g. rstudio server) with minor modifications. The .Rprofile generated by the function can be used as Rprofile.site and will apply to all users of that R installation. Each user should have their own project directories with a baseproject on the system. The .Renviron file should be modified for each user to point to this directory and saved in the home directory. There should be a subdirectory in user_projects with each user's ID for their project libraries. Ownership should be given to the user/group and permissions set accordingly, e.g. 755.

Upgrading R versions: since package binaries don't work across minor version changes in R, e.g. 4.2 -\> 4.3, you will have to create a new cache directory each time this changes.
